const ExpressionBuilder = require('../../db/sql-builder').ExpressionBuilder

class CustomExpressionBuilder extends ExpressionBuilder {
  get ReferenceBuilder() {
    const ReferenceBuilder = require('./CustomReferenceBuilder')
    Object.defineProperty(this, 'ReferenceBuilder', { value: ReferenceBuilder })
    return ReferenceBuilder
  }

  get SelectBuilder() {
    const SelectBuilder = require('./CustomSelectBuilder')
    Object.defineProperty(this, 'SelectBuilder', { value: SelectBuilder })
    return SelectBuilder
  }

  get FunctionBuilder() {
    const FunctionBuilder = require('./CustomFunctionBuilder')
    Object.defineProperty(this, 'FunctionBuilder', { value: FunctionBuilder })
    return FunctionBuilder
  }

  _addListToOutputObj(list) {
    this._outputObj.sql.push('(')

    // sqlite requires "VALUES" keyword for list of list of values
    if (list[0] && list[0].list && list[0].list[0] && 'val' in list[0].list[0]) {
      this._outputObj.sql.push('VALUES')
    }

    for (let i = 0, len = list.length; i < len; i++) {
      this._expressionElementToSQL(list[i])

      if (len > 1 && i + 1 < len) {
        this._outputObj.sql.push(',')
      }
    }

    this._outputObj.sql.push(')')
  }
}

module.exports = CustomExpressionBuilder
