const cds = require ('../../index')
const _cached = Symbol('for Node.js')

module.exports = function cds_compile_for_nodejs (csn,o) {
  if (!csn) return
  const cached = csn[_cached]; if (cached) return cached
  // csn = cds.minify (csn)
  csn = cds.compile.for.drafts (csn,o) //> creates a partial copy -> avoid any cds.linked() before
  csn = cds.compile._localized.unfold_csn (csn)
  csn = cds.linked (csn)
  return csn[_cached] = csn
}
